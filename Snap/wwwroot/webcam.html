<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PhotoBooth</title>
    <style>
        video, canvas {
            border: 1px solid black;
        }

        #preview, #uploadStatus {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>PhotoBooth (2x2 Layout Example)</h1>

    <video id="webcam" autoplay playsinline width="320" height="240"></video><br>
    <button onclick="capturePhoto()">📸 Capture Photo</button>
    <div id="preview"></div>
    <div id="uploadStatus"></div>

    <script>
    const webcam = document.getElementById('webcam');
    const preview = document.getElementById('preview');
    const uploadStatus = document.getElementById('uploadStatus');

    const sessionId = "session_" + crypto.randomUUID();
    const layoutType = "2x2";
    let sequence = 1;

    // Ask for camera access
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => webcam.srcObject = stream)
      .catch(err => alert("Camera access denied: " + err));

    async function capturePhoto() {
      const canvas = document.createElement('canvas');
      canvas.width = webcam.videoWidth;
      canvas.height = webcam.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(webcam, 0, 0, canvas.width, canvas.height);

      const base64Image = canvas.toDataURL('image/jpeg'); // Includes prefix

      preview.innerHTML = `<img src="${base64Image}" width="160"/>`;

      const payload = {
        base64Image,
        sessionId,
        sequence,
        layoutType
      };

      uploadStatus.textContent = "Uploading photo " + sequence + "...";

      const res = await fetch("/Photo/UploadPhoto", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const result = await res.json();
      if (res.ok) {
        uploadStatus.innerHTML = `✅ Photo ${sequence} uploaded: <code>${result.fileName}</code>`;
        sequence++;
      } else {
        uploadStatus.innerHTML = `❌ Error uploading photo ${sequence}: ${result}`;
      }

      if (sequence > 4) {
        alert("📦 All 4 photos captured for 2x2 layout!");
      }
    }
    </script>
</body>
</html>
